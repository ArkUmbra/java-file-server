// requires the 'jacoco' plugin to be set

jacoco {
    toolVersion = "0.8.3"
}

jacocoTestReport {
    reports {
        xml.enabled false
        csv.enabled true
        html.destination file("${buildDir}/jacocoHtml")
        csv.destination file("${buildDir}/jacocoCsv")
    }
    afterEvaluate {
        classDirectories = files(classDirectories.files.collect {
            fileTree(dir: it,
                    exclude: []
            )
        })
    }
}


task printTestCoverage(type: Exec) {
    executable "sh"
    args "-c", "awk -F\",\" '{ instructions += \$4 + \$5; covered += \$5 } END { print covered/instructions*100, \"% covered\" }' build/jacocoCsv"
}